---
title: "statistical_analysis"
author: "Dominik Dianovics"
format: html
---

# Researcher burnout and questionable research practice pilot data analysis

## Statistical analysis

### Load libraries

```{r echo = FALSE ouput = FALSE}
if(!require("tidyverse")) install.packages("tidyverse")
if(!require("here")) install.packages("here")
if(!require("lavaan")) install.packages("lavaan")
if(!require("MVN")) install.packages("MVN")
if(!require("semPlot")) install.packages("semPlot")
if(!require("influence.SEM")) install.packages("influence.SEM")
if(!require("mice")) install.packages("mice")
if(!require("devtools")) install.packages("devtools")
if(!require("semPower")) install.packages("semPower")
if(!require("car")) install.packages("car")
if(!require("MASS")) install.packages("MASS")
library(tidyverse)
library(here)
library(ggplot2)
library(lavaan)
library(MVN)
library(semPlot)
library(influence.SEM)
library(mice)
library(devtools)
library(semPower)
library(car)
library(MASS) 
data_path <- here("data")

```

### Load data

```{r echo = FALSE ouput = FALSE}
data = read_csv(here::here("data/processed/aggregated_data.csv"))
```

# Latent variables as imagined by the Job Demands-Resources Model of Burnout

# Job demands and resources

```{r}
# Additional information:
# Scores are aggregate means of the respective scales.
# For a larger dataset, parceling or item-level analysis could be rlcsidered.
# Missing data imputation was not performed for SEM
# There is multivariate non-normality, so robust ML estimation is used.
# Data is linear, and no multicollinearity issues were detected.
# Outliers were detected using Cook's distance, and a model without outliers was also evaluated.
# The proposed model is familiar to you, however, in the final model, I have taken the pay, tool, and general satisfaction items out of the job resources latent variable due to their low loadings and high residuals.
```

## Job demands as latent variable measured by item-level indicators

```{r}
#Job demands are: workload, pubplication pressure_stress, publication_pressure_attitude, role stressors such as rlaiguity and rlcflict, work-life balance

job_demands_item = data |>
  dplyr::select(anonym_id, starts_with(c("wld_", "ppa_", "pps_", "rla_", "rlc_", "wlb_")))

job_demands_latent_item = cfa(
  '
  # First-order factors
  wld =~ wld_1 + wld_2 + wld_3 + wld_4
  rla =~ rla_1 + rla_2 + rla_3 + rla_4 + rla_5 + rla_6
  rlc =~ rlc_1 + rlc_2 + rlc_3 + rlc_4 + rlc_5 + rlc_6
  wlb =~ wlb_1 + wlb_2 + wlb_3 + wlb_4
  
  # Structural model
  job_demands =~ wld + rla + rlc + wlb
  
  # Residual correlations based on theory and expected overlap
    rla ~~ rlc
    rlc_1 ~~ rlc_6
  ',
  data = job_demands_item,
  estimator = "MLR",
  std.lv = TRUE
)
summary(job_demands_latent_item, fit.measures = TRUE, standardized = TRUE, modindices = TRUE)


summary_text <- capture.output(summary(job_demands_latent_item, fit.measures = TRUE, standardized = TRUE, modindices = TRUE))
writeLines(summary_text, here::here("analysis/tables/job_demands_summary.txt"))
pdf(here::here("analysis/figures/demands_cfa_plot.pdf"), width = 10, height = 8)
semPaths(job_demands_latent_item, what = "std", style = "lisrel", layout = "tree", residuals = TRUE, rotation = 4, sizeMan = 12, sizeMan2 = 6, nCharNodes = 6)
dev.off()
```

## Job demands as latent variable measured by construct-level indicators

```{r}
#Job demands are: workload, pubplication pressure_stress, publication_pressure_attitude, role stressors such as rlaiguity and rlcflict, work-life balance

job_demands = data |>
  dplyr::select(anonym_id, wld, rla, rlc, wlb)

job_demands_latent = cfa(
  '
  # Measurement model
  job_demands =~ wld + rla + rlc + wlb
  
  # Residual correlations based on theory and expected overlap
    rla ~~ rlc
  ',
  data = job_demands,
  estimator = "MLR",
  std.lv = TRUE
)
summary(job_demands_latent, fit.measures = TRUE, standardized = TRUE, modindices = TRUE)


summary_text <- capture.output(summary(job_demands_latent, fit.measures = TRUE, standardized = TRUE, modindices = TRUE))
writeLines(summary_text, here::here("analysis/tables/job_demands_summary.txt"))
pdf(here::here("analysis/figures/demands_cfa_plot.pdf"), width = 10, height = 8)
semPaths(job_demands_latent, what = "std", style = "lisrel", layout = "tree", residuals = TRUE, rotation = 4, sizeMan = 12, sizeMan2 = 6, nCharNodes = 6)
dev.off()
```

## Job resources as latent variable measured by item-level indicators

```{r}
job_resources_item = data |>
  dplyr::select(anonym_id, starts_with(c("opp_", "mng_", "inf_", "scc_", "scs_", "sec_")))

job_resources_latent_item = cfa(
  '
  opp =~ opp_1 + opp_2 + opp_3
  mng =~ mng_1 + mng_2 
  inf =~ inf_1 + inf_2 + inf_3 + inf_4 + inf_5 + inf_6
  scs =~ scs_1 + scs_2 + scs_3 
  scc =~ scc_1 + scc_2 + scc_3
  sec =~ sec_1 + sec_2 + sec_3 + sec_4
  
  job_resources =~ opp + mng + inf + scs + scc + sec
  ',
  data = job_resources_item,
  estimator = "MLR",
  std.lv = TRUE
)
summary(job_resources_latent_item, fit.measures = TRUE, standardized = TRUE, modindices = TRUE)
modindices(job_resources_latent_item, sort = TRUE)

summary_text <- capture.output(summary(job_resources_latent_item, fit.measures = TRUE, standardized = TRUE, modindices = TRUE))
writeLines(summary_text, here::here("analysis/tables/job_resources_summary.txt"))

pdf(here::here("analysis/figures/resources_cfa_plot.pdf"), width = 10, height = 8)
semPaths(job_resources_latent_item, what = "stand", layout = "tree", rotation = 4, sizeMan = 12, sizeMan2 = 6, nCharNodes = 6)
dev.off()
```

## Job resources as latent variable measured by construct-level indicators

```{r}
#Job resources are: opportunities, meaning, influence, social support, job insecurity

job_resources = data |>
  dplyr::select(anonym_id, opp, mng, inf, scc, scs, sec)

job_resources_latent = cfa(
  '
  job_resources =~ opp + mng + inf + scc + scs + sec
  ',
  data = job_resources,
  estimator = "MLR",
  std.lv = TRUE
)
summary(job_resources_latent, fit.measures = TRUE, standardized = TRUE, modindices = TRUE)
modindices(job_resources_latent, sort = TRUE)

summary_text <- capture.output(summary(job_resources_latent, fit.measures = TRUE, standardized = TRUE, modindices = TRUE))
writeLines(summary_text, here::here("analysis/tables/job_resources_summary.txt"))

pdf(here::here("analysis/figures/resources_cfa_plot.pdf"), width = 10, height = 8)
semPaths(job_resources_latent, what = "stand", layout = "tree", rotation = 4, sizeMan = 12, sizeMan2 = 6, nCharNodes = 6)
dev.off()
```

## Job demands and resources plus burnout: Structural equation modeling

```{r}
jdr_b_model = '
  # Measurement model
  job_demands =~ wld + rla + rlc + wlb
  job_resources =~ opp + mng + inf + scc + scs + sec
  
  # Residual correlations
  rla ~~ rlc
  
  # Structural model
  brt ~ job_demands + job_resources
'
```

### JDR-Burnout model fitting

```{r}
jdr_b_fit = sem(jdr_b_model, data = data, std.lv = TRUE, estimator = "MLR", se = "robust.sem")

summary(jdr_b_fit, fit.measures = TRUE, standardized = TRUE, modindices = TRUE, rsquare = TRUE)
modindices(jdr_b_fit, sort = TRUE)
# compRelSEM(jdr_b_fit, higher = c("job_demands", "job_resources"))  # if model uses latent variables


summary_text <- capture.output(summary(jdr_b_fit, fit.measures = TRUE, standardized = TRUE, modindices = TRUE))
writeLines(summary_text, here::here("analysis/tables/jdr_burnout_fit_summary.txt"))
```

### Visualizing model

```{r}
pdf(here::here("analysis/figures/sem_plot.pdf"), width = 10, height = 8)
semPaths(jdr_b_fit, 
         what = "stand", 
         layout = "tree2", 
         rotation = 2,
         style = "mx",
         posCol = "black",
         negCol = "black",
         nCharNodes = 0,
         residuals = TRUE,
         weighted = TRUE,
         optimizeLatRes = TRUE,
         fade = FALSE,
         edge.color = "black",
         mar = c(3, 5, 3, 5)
         )
dev.off()
```

### Evaluating model

```{r}
#inspect(jdr_b_fit, "std")
```

# Final model

```{r}
write.csv(data_no_outliers, here::here("data/processed/data_no_outliers.csv"), row.names = FALSE)

# ppa also removed
jdr_final_model = '
  # First-order factors
  wld =~ wld_1 + wld_2 + wld_3 + wld_4
  rla =~ rla_1 + rla_2 + rla_3 + rla_4 + rla_5 + rla_6
  wlb =~ wlb_1 + wlb_2 + wlb_3 + wlb_4
  rlc =~ rlc_1 + rlc_2 + rlc_3 + rlc_4 + rlc_5 + rlc_6
  
  opp =~ opp_1 + opp_2 + opp_3
  mng =~ mng_1 + mng_2 
  inf =~ inf_1 + inf_2 + inf_3 + inf_4 + inf_5 + inf_6
  scs =~ scs_1 + scs_2 + scs_3 
  scc =~ scc_1 + scc_2 + scc_3
  sec =~ sec_1 + sec_2 + sec_3 + sec_4
  
  burnout =~ brt_1 + brt_2 + brt_3 + brt_4
  
  # Job Demands
  job_demands =~ wld + rla + wlb + rlc

  # Job Resources
  job_resources =~ opp + mng + inf + scs + scc + sec
  
  # Allowing latent factors to correlate
  job_demands ~~ job_resources
  
  # burnout is regressed on job demands and job resources
  job_demands ~ burnout
  job_resources ~ burnout
  
  # Allowing theoretically related indicators and factors to correlate
  scs ~~ scc
  rla ~~ rlc
  rla_5 ~~ rla_6
  rlc_1 ~~ rlc_6
  '

jdr_final_fit = sem(jdr_final_model, data = processed, std.lv = TRUE, estimator = "MLR")

summary(jdr_final_fit, fit.measures = TRUE, standardized = TRUE, modindices = TRUE, rsquare = TRUE)
modindices(jdr_final_fit, sort = TRUE)


```

